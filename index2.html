<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Invocar Servicio</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    form {
      max-width: 600px;
      margin: auto;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 10px;
      background-color: #f9f9f9;
    }
    textarea, button, select {
      width: 100%;
      margin: 10px 0;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    button {
      background-color: #007BFF;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
    .response {
      margin-top: 20px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      background-color: #f4f4f4;
    }
    .token-container {
      display: flex;
      align-items: center;
      margin-top: 10px;
    }
    .token-field {
      flex: 1;
      padding: 5px;
      border: 1px solid #ccc;
      border-radius: 5px;
      background-color: #e9ecef;
      font-family: monospace;
      overflow-x: auto;
      white-space: nowrap;
    }
  </style>
</head>
<body>
  <h1>Invocar Servicio</h1>
  <form id="serviceForm">
    <label for="environment">Selecciona el ambiente:</label>
    <select id="environment" required>
      <option value="dev">Desarrollo (DEV)</option>
      <option value="qa">Calidad (QA)</option>
      <option value="cert" selected>Certificación (CERT)</option>
    </select>

    <label for="functionality">Selecciona la funcionalidad:</label>
    <select id="functionality" required>
      <option value="cuenta_nicaragua" selected>NICARAGUA-CUENTA</option>
      <option value="tarjeta_nicaragua_mercadoabierto">NICARAGUA-TARJETA-MERCADO ABIERTO</option>
	  <option value="tarjeta_costarica_mercadoabierto">COSTA RICA-TARJETA-MERCADO ABIERTO</option>
	  <option value="ysi_guatemala_mercadoabierto">GUATEMALA-YSI-MERCADO ABIERTO</option>	
      <option value="tarjeta_panama_mercadoabierto">PANAMA-TARJETA-MERCADO ABIERTO</option>	
	  <option value="extracash_panama_canalautenticado">PANAMA-EXTRACASH-CANAL AUTENTICADO</option>	  
    </select>

    <label for="requestBody">Cuerpo de la solicitud (JSON):</label>
    <textarea id="requestBody" rows="10" placeholder="El cuerpo del JSON aparecerá aquí" required></textarea>
    <button type="submit">Enviar Solicitud</button>
  </form>
  <div id="response" class="response" hidden>
    <label for="resultField">URL Concatenada:</label>
    <div class="token-container">
      <input id="resultField" class="token-field" readonly>
    </div>
  </div>

  <script>
    const configurations = {
      dev: {
        baseUrl: 'https://onboardingreg-development.pfcti.com',
        username: 'dev_soporte',
        password: '54e8786fd74d53e5436558ea75216afff4680a48f22a38993ed98aa401aa2072',
        functionalities: {
          cuenta_nicaragua: {
			 "codAgencia": "1004",
			 "username": "DSandoval2023",
			 "idNumber": "084-051169-0004X",
			 "channel": "Digital",
			 "application": "BM", 
			 "view": "CTD-NICARAGUA", 
			 "suscriptionID": "NI10100320001",
			 "categoryCode": "PRDMIL",
			 "mode": "PRODUCTION",
			 "transactionId": ""
			},
          tarjeta_nicaragua_mercadoabierto: {
				"codAgencia": "",
				"username": "",
				"idNumber": "",
				"channel": "Digital",
				"application": "BM",
				"view": "Mercado-abierto-nic",
				"suscriptionID": "NI10100320001",
				"categoryCode": "PRDMIL",
				"mode": "PRODUCTION",
				"referralCode": "<--referred code-->"
			},
			tarjeta_costarica_mercadoabierto: {
				"codAgencia": "",
				"username": "",
				"channel": "WEB",
				"application": "WEB",
				"view": "Mercado-abierto-cr",
				"mode": "PRODUCTION",
				"subscriptionId": "CR10100320001",
				"transactionId": 1122323
			},
			ysi_guatemala_mercadoabierto:{
				"codAgencia": "29902",
				"idNumber": "",
				"channel": "WEB",
				"username": "",
				"application": "WEB",
				"view": "Mercado-abierto-gt-ysi",
				"mode": "PRODUCTION",
				"suscriptionID": "GT10100320001",
				"linkActualizacion": "",
				"transactionId": 101010,
				"categoryCode": "",
				"campaign": ""
			},
			tarjeta_panama_mercadoabierto:{
				"codAgencia": "",
				"username": "",
				"idNumber": "",
				"channel": "APP", // Variar segun en canal de entrada
				"application": "",
				"view": "Mercado-abierto-pan",
				"subscriptionId": "PA10100180001" //Cambiar por subscriptionId productivo
			},
			extracash_panama_canalautenticado:{
			  "codAgencia": "",
			  "username": "",
			  "idNumber": "112380912",
			  "channel": "Digital",
			  "application": "Banca Móvil",
			  "view": "Extracash-pan",
			  "mode": "PRODUCTION",
			  "subscriptionId": "PA10100320001",
			  "transactionId": 123,
			  "categoryCode": "0010"
			}
        }
      },
      qa: {
        baseUrl: 'https://onboardingreg-qa.pfcti.com',
        username: 'qa_soporte',
        password: '54e8786fd74d53e5436558ea75216afff4680a48f22a38993ed98aa401aa2072',
        functionalities: {
          cuenta_nicaragua: {
			 "codAgencia": "1004",
			 "username": "DSandoval2023",
			 "idNumber": "084-051169-0004X",
			 "channel": "Digital",
			 "application": "BM", 
			 "view": "CTD-NICARAGUA", 
			 "suscriptionID": "NI10200320001",
			 "categoryCode": "PRDMIL",
			 "mode": "PRODUCTION",
			 "transactionId": ""
			},
          tarjeta_nicaragua_mercadoabierto: {
				"codAgencia": "",
				"username": "",
				"idNumber": "",
				"channel": "Digital",
				"application": "BM",
				"view": "Mercado-abierto-nic",
				"suscriptionID": "NI10200320001",
				"categoryCode": "PRDMIL",
				"mode": "PRODUCTION",
				"referralCode": "<--referred code-->"
			},
		  tarjeta_costarica_mercadoabierto: {
				"codAgencia": "",
				"username": "",
				"channel": "WEB",
				"application": "WEB",
				"view": "Mercado-abierto-cr",
				"mode": "PRODUCTION",
				"subscriptionId": "CR10200320001",
				"transactionId": 1122323
			},
		  ysi_guatemala_mercadoabierto:{
				"codAgencia": "29902",
				"idNumber": "",
				"channel": "WEB",
				"username": "",
				"application": "WEB",
				"view": "Mercado-abierto-gt-ysi",
				"mode": "PRODUCTION",
				"suscriptionID": "GT10200320001",
				"linkActualizacion": "",
				"transactionId": 101010,
				"categoryCode": "",
				"campaign": ""
			},
			tarjeta_panama_mercadoabierto:{
				"codAgencia": "",
				"username": "",
				"idNumber": "",
				"channel": "APP", // Variar segun en canal de entrada
				"application": "",
				"view": "Mercado-abierto-pan",
				"subscriptionId": "PA10200180001" //Cambiar por subscriptionId productivo
			},
			extracash_panama_canalautenticado:{
			  "codAgencia": "",
			  "username": "",
			  "idNumber": "112380912",
			  "channel": "Digital",
			  "application": "Banca Móvil",
			  "view": "Extracash-pan",
			  "mode": "PRODUCTION",
			  "subscriptionId": "PA10200320001",
			  "transactionId": 123,
			  "categoryCode": "0010"
			}
        }
      },
      cert: {
        baseUrl: 'https://onboardingreg-cert.pfcti.com',
        username: 'usr_cnl_ib',
        password: 'demo',
        functionalities: {
          cuenta_nicaragua: {
			 "codAgencia": "1004",
			 "username": "DSandoval2023",
			 "idNumber": "084-051169-0004X",
			 "channel": "Digital",
			 "application": "BM", 
			 "view": "CTD-NICARAGUA", 
			 "suscriptionID": "NI10300320001",
			 "categoryCode": "PRDMIL",
			 "mode": "PRODUCTION",
			 "transactionId": ""
			},
          tarjeta_nicaragua_mercadoabierto: {
				"codAgencia": "",
				"username": "",
				"idNumber": "",
				"channel": "Digital",
				"application": "BM",
				"view": "Mercado-abierto-nic",
				"suscriptionID": "NI10300320001",
				"categoryCode": "PRDMIL",
				"mode": "PRODUCTION",
				"referralCode": "<--referred code-->"
			},
		  tarjeta_costarica_mercadoabierto: {
				"codAgencia": "",
				"username": "",
				"channel": "WEB",
				"application": "WEB",
				"view": "Mercado-abierto-cr",
				"mode": "PRODUCTION",
				"subscriptionId": "CR10300320001",
				"transactionId": 1122323
			},
			ysi_guatemala_mercadoabierto:{
				"codAgencia": "29902",
				"idNumber": "",
				"channel": "WEB",
				"username": "",
				"application": "WEB",
				"view": "Mercado-abierto-gt-ysi",
				"mode": "PRODUCTION",
				"suscriptionID": "GT10300320001",
				"linkActualizacion": "",
				"transactionId": 101010,
				"categoryCode": "",
				"campaign": ""
			},
			tarjeta_panama_mercadoabierto:{
				"codAgencia": "",
				"username": "",
				"idNumber": "",
				"channel": "APP", // Variar segun en canal de entrada
				"application": "",
				"view": "Mercado-abierto-pan",
				"subscriptionId": "PA10300180001" //Cambiar por subscriptionId productivo
			},
			extracash_panama_canalautenticado:{
			  "codAgencia": "",
			  "username": "",
			  "idNumber": "112380912",
			  "channel": "Digital",
			  "application": "Banca Móvil",
			  "view": "Extracash-pan",
			  "mode": "PRODUCTION",
			  "subscriptionId": "PA10300320001",
			  "transactionId": 123,
			  "categoryCode": "0010"
			}
        }
      }
    };

    const environmentSelect = document.getElementById('environment');
    const functionalitySelect = document.getElementById('functionality');
    const requestBodyTextarea = document.getElementById('requestBody');

    function updateRequestBody() {
      const environment = environmentSelect.value;
      const functionality = functionalitySelect.value;
      const environmentConfig = configurations[environment];
      const requestBody = environmentConfig?.functionalities[functionality];

      if (requestBody) {
        requestBodyTextarea.value = JSON.stringify(requestBody, null, 2); // Formatea JSON
      } else {
        requestBodyTextarea.value = '';
      }
    }

    environmentSelect.addEventListener('change', updateRequestBody);
    functionalitySelect.addEventListener('change', updateRequestBody);

    // Llama a la función al cargar la página para inicializar el cuerpo del request.
    document.addEventListener('DOMContentLoaded', updateRequestBody);

    document.getElementById('serviceForm').addEventListener('submit', async (event) => {
      event.preventDefault();

      const environment = environmentSelect.value;
      const environmentConfig = configurations[environment];
      const authHeader = `Basic ${btoa(`${environmentConfig.username}:${environmentConfig.password}`)}`;
      const requestBody = requestBodyTextarea.value;

      try {
        const response = await fetch(`${environmentConfig.baseUrl}/auth/authorizer/api/v1/token/tokenVista/obtener`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': authHeader,
          },
          body: requestBody,
        });

        const data = await response.json();
        const responseDiv = document.getElementById('response');
        responseDiv.hidden = false;

        if (response.ok) {
          const token = data.token;
          const resultField = document.getElementById('resultField');
          const finalUrl = `${environmentConfig.baseUrl}/alfred/ui/${token}`;
          resultField.value = finalUrl;
          window.open(finalUrl, '_blank');
        } else {
          const resultField = document.getElementById('resultField');
          resultField.value = `Error: ${data.message || 'No se pudo completar la solicitud.'}`;
          resultField.style.color = 'red';
        }
      } catch (error) {
        const resultField = document.getElementById('resultField');
        resultField.value = `Error de conexión: ${error.message}`;
        resultField.style.color = 'red';
      }
    });
  </script>

</body>
</html>
