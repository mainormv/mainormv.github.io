<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Redireccionando con Token...</title>
  <script>
    window.onload = async function () {
      const baseUrl = 'https://onboardingreg-cert.pfcti.com';
      const tokenUrl = `${baseUrl}/auth/authorizer/api/v1/token/tokenVista/obtener`;

      // Credenciales para Basic Auth
      const username = 'usr_cnl_ib';
      const password = 'demo';
      const authHeader = 'Basic ' + btoa(`${username}:${password}`);

      // Payload a enviar
      const requestBody = JSON.stringify({
		  "codAgencia": "",
		  "username": "",
		  "idNumber": "",
		  "channel": "Digital",
		  "application": "BM",
		  "view": "Mercado-abierto-nic",
		  "suscriptionID": "NI10300320001",
		  "categoryCode": "PRDMIL",
		  "mode": "PRODUCTION",
		  "referralCode": "<--referred code-->"
		});

      try {
        const response = await fetch(tokenUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': authHeader
          },
          body: requestBody
        });

        if (!response.ok) {
          throw new Error(`Error al obtener el token: ${response.status}`);
        }

        const data = await response.json();
        const token = data.token;

        if (!token) {
          throw new Error("Token no encontrado en la respuesta.");
        }

        // Construir URL final y redirigir
        const i = `${baseUrl}/alfred/ui/`;
        const queryParams = window.location.search;
        const finalUrl = i + token + queryParams;

        window.location.href = finalUrl;

      } catch (error) {
        console.error("Error durante el proceso:", error);
        document.body.innerHTML = "<h3>Error al obtener el token o redireccionar.</h3><p>" + error.message + "</p>";
      }
    };
  </script>
</head>
<body>
  <p>Obteniendo token y redireccionando, por favor espera...</p>
</body>
</html>
